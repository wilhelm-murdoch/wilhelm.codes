<!DOCTYPE html>
<html lang="en-us" dir="ltr">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet" />
<title>Liberating custom Slack emojis | Wilhelm Codes</title>

    <link rel="stylesheet" href="/main.css" />

<script type="text/javascript">
  const lazy = new IntersectionObserver((entries) => {
    const loaded = (entry) => {
      entry.target.style.opacity = "1";
    };

    entries.forEach((entry) => {
      if (!entry.isIntersecting) return;

      if (entry.target.complete) {
        loaded(entry);
      } else {
        entry.target.addEventListener("load", loaded);
      }

      lazy.unobserve(entry.target);
    });
  });

  window.onload = () => {
    images = document.querySelectorAll("img.lazy");

    images.forEach((image) => {
      lazy.observe(image);
    });
  };
</script>
  </head>
  <body>
    <div class="m-10">
      <nav class="flex justify-center space-x-10 my-8 mb-16 font-semibold text-lg text-slate-600">
  <a href="http://localhost:1313/" title="Latest" class="border-b-4 border-blue-600">Latest</a>
  <a href="http://localhost:1313/" title="Archvie" class="border-b-4 border-slate-200">Archive</a>
  <a href="http://localhost:1313//index.xml" title="RSS" class="border-b-4 border-slate-200">RSS</a>
</nav>
      <main class="fade-in-animation">
        
  <header class="mx-auto max-w-4xl text-center mb-8 pb-8 border-b relative category-random-bullshit">
    <a href="" title="" class="category p-2 rounded-md text-sm font-medium inline-block">
      <svg class="h-4 w-4 -mt-1 inline-block opacity-50 mr-1" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
  
  <path d="M480 32c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9L381.7 53c-48 48-113.1 75-181 75l-8.7 0-32 0-96 0c-35.3 0-64 28.7-64 64l0 96c0 35.3 28.7 64 64 64l0 128c0 17.7 14.3 32 32 32l64 0c17.7 0 32-14.3 32-32l0-128 8.7 0c67.9 0 133 27 181 75l43.6 43.6c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6l0-147.6c18.6-8.8 32-32.5 32-60.4s-13.4-51.6-32-60.4L480 32zm-64 76.7L416 240l0 131.3C357.2 317.8 280.5 288 200.7 288l-8.7 0 0-96 8.7 0c79.8 0 156.5-29.8 215.3-83.3z" />
</svg>
      Random Bullshit
    </a>
    
      
      
        +
        
          <span class="border-b-2 border-b-slate-100 font-medium text-slate-500">emoji</span>
          ,
        
          <span class="border-b-2 border-b-slate-100 font-medium text-slate-500">api</span>
          ,
        
          <span class="border-b-2 border-b-slate-100 font-medium text-slate-500">bash</span>
          &nbsp;&amp;&nbsp;
          
        
          <span class="border-b-2 border-b-slate-100 font-medium text-slate-500">api</span>
          
        
      
    
    <h1 class="text-5xl my-8 font-bold leading-tight">Liberating custom Slack emojis</h1>
    <div class="text-justify text-2xl text-slate-500 font-extralight my-8"><p>As is stupid tradition, whenever I start at a new company, one of the first things I like to do while getting settled in is upload my favourite emojis to whatever real-time messaging platform is in use. I know it’s childish, but silly memes and emojis are great ways for you to break the ice with your new coworkers.</p></div>
    <a href="/blog/liberating-custom-slack-emojis/" title="Liberating custom Slack emojis" class="article-card overflow-hidden rounded-2xl block ring-4 border-4 border-white">
      
      
        <img src="/blog/liberating-custom-slack-emojis/header.jpeg" alt="Liberating custom Slack emojis" class="aspect-video object-cover lazy" />
      
    </a>
    <div class="mt-8 text-slate-400 text-sm">
      
      
      <time datetime="2022-09-20T00:00:00&#43;00:00">Sep 20, 2022</time>
      &middot;
      8 min read
    </div>
  </header>

  <article class="mx-auto max-w-4xl mb-8 pb-8 border-b prose-xl prose-p:text-slate-700 prose-p:font-extralight prose-h3:font-semibold prose-h3:text-slate-700 prose-pre:overflow-x-auto">
    <p>But, when it comes time to part ways it’s only understandable to want to gather your stuff for the next place to start the process again. Over the years one can collect and curate quite a nice hoard of stupid images.</p>
<p>I’ve been using Slack prolifically for the past few years. Unfortunately, there is no simple way of exporting your precious collection outside of the old “right-click and save” method. This is effective for smaller collections of a couple dozen or so, but becomes impractical when there are hundreds or even thousands.</p>
<p>And, of course, I’m not alone. There have been a non-zero number of times when someone left the company only to hit me up later asking for an emoji archive.</p>
<p>Yes, this really happens and something <em>must</em> be done about it!</p>
<p>What follows is an unnecessarily long dive into a little bit of reverse engineering one of Slack’s API endpoints, subverting it for our own use and writing a stupid little tool to help ourselves ( and others ) automate this process for the future.</p>
<h2 id="some-investigative-work">Some Investigative Work</h2>
<p>There just has to be a straightforward way we can <em>mostly</em> automate this. So, I did some cursory digging around the Chrome Developer Tools console and found this endpoint in the “Network” tab:</p>
<pre tabindex="0"><code>https://edgeapi.slack.com/cache/T0XXXX/emojis/list?fp=97
</code></pre><p>The <code>T0XXXX</code> will be your workspace, or team, id. Make note of it, you’ll need it later.</p>
<p>If you intercept one of these requests and take a peak at the “Response” tab in the “Network” panel, you’ll see a JSON response with a structure similar to:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1">&#34;ok&#34;</span><span style="color:#eceff4">:</span> <span style="color:#81a1c1;font-weight:bold">true</span><span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1">&#34;next_marker&#34;</span><span style="color:#eceff4">:</span> <span style="color:#a3be8c">&#34;a-custom-emoji&#34;</span><span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1">&#34;results&#34;</span><span style="color:#eceff4">:</span> <span style="color:#eceff4">[</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1">&#34;name&#34;</span><span style="color:#eceff4">:</span> <span style="color:#a3be8c">&#34;another-custom-emoji&#34;</span><span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#81a1c1">&#34;value&#34;</span><span style="color:#eceff4">:</span> <span style="color:#a3be8c">&#34;https://emoji.slack-edge.com/T0XXXX/another-custom-emoji/xxxxxxx.png&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#bf616a">...</span> <span style="color:#bf616a">more</span> <span style="color:#bf616a">emojis</span> <span style="color:#bf616a">...</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><ul>
<li><code>ok</code> tells you whether the request was successful or not. If it returns <code>false</code> there will be an additional field named <code>error</code> that should clue you into what went wrong.</li>
<li><code>next_marker</code> tells you where in the list of custom emoji the <em>next</em> page of results should start. We use this as the value of <code>marker</code> in subsequent request payloads ( see below ). This is effectively how you page through large lists of emoji.</li>
<li><code>results</code> should be obvious, but it contains an array of objects with <code>name</code> and <code>value</code> fields.
<ul>
<li><code>name</code> is the alias of the emoji.</li>
<li><code>value</code> is the direct CDN URL to the emoji.</li>
</ul>
</li>
</ul>
<p>You may see other fields, but <code>next_marker</code> and <code>value</code> are the only fields we really care about.</p>
<p>Next, If you take a look at the “Payload” tab in the “Network” panel for the same request, you’ll see something similar to:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1">&#34;token&#34;</span><span style="color:#eceff4">:</span> <span style="color:#a3be8c">&#34;xoxc-xxxx-xxxx-xxxx&#34;</span><span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1">&#34;count&#34;</span><span style="color:#eceff4">:</span> <span style="color:#b48ead">100</span><span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1">&#34;marker&#34;</span><span style="color:#eceff4">:</span> <span style="color:#a3be8c">&#34;some-other-emoji&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><ul>
<li><code>token</code> is the API request token the Slack client uses to make the emoji list request on your behalf.</li>
<li><code>count</code> is the amount of emojis to return as a page.</li>
<li><code>marker</code> tells the API where in the emoji list to start paging.</li>
</ul>
<p>The final piece of the puzzle is getting the value of your session cookie. You can grab this by clicking the “Request Headers” section under the “Headers” tab. You should see a header labeled <code>cookie</code>.</p>
<p>There’s going to be a fairly large block of text to parse through, but you’re looking for the cookie named <code>d</code>. Save everything between the <code>d=</code> and the closing <code>;</code>. You’re going to need this to authenticate with the Slack API itself.</p>
<h2 id="testing-your-findings">Testing Your Findings</h2>
<p>We now understand the structure of our payload. We also have the endpoint to hit as well as our tokens and session cookie to authenticate. Piecing it all together, you can now use cURL to hit the API directly from your terminal:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl --silent https://edgeapi.slack.com/cache/&lt;team&gt;/emojis/list?fp<span style="color:#81a1c1">=</span><span style="color:#b48ead">97</span>
</span></span><span style="display:flex;"><span>  -H <span style="color:#a3be8c">&#39;cookie: d=&lt;cookie&gt;;&#39;</span> <span style="color:#ebcb8b">\
</span></span></span><span style="display:flex;"><span><span style="color:#ebcb8b"></span>  --data-raw <span style="color:#a3be8c">&#39;{&#34;token&#34;:&#34;&lt;token&gt;&#34;,&#34;count&#34;:10}&#39;</span>
</span></span></code></pre></div><p>Replace the following:</p>
<ul>
<li><code>&lt;team&gt;</code> is your workspace, or team, id.</li>
<li><code>&lt;cookie&gt;</code> is your session cookie value.</li>
<li><code>&lt;token&gt;</code> is your request token.</li>
</ul>
<p>If everything worked out, you should have successful API response like the one above. If the response has root field named <code>marker_next</code>, make note of the associated value to help page through subsequent results. Keep doing this in a loop until your response no longer returns a <code>marker_next</code> field.</p>
<p>Once that happens, you’re at the end of the list.</p>
<p>With a little bit of help from <code>jq</code> to parse and filter the JSON responses, we can grab a simple list of URLs.</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ &lt;previous_curl_command&gt; <span style="color:#eceff4">|</span> jq -r <span style="color:#a3be8c">&#39;.results[].value&#39;</span>
</span></span><span style="display:flex;"><span>https://emoji.slack-edge.com/T0XXXX/no/060fca9aa2581a93.png
</span></span><span style="display:flex;"><span>https://emoji.slack-edge.com/T0XXXX/nods/c7fe54342ab5b8b6.gif
</span></span><span style="display:flex;"><span>https://emoji.slack-edge.com/T0XXXX/nods-back/fbd1b5384cdd0905.gif
</span></span><span style="display:flex;"><span>https://emoji.slack-edge.com/T0XXXX/nomnomnom/612cfc74c785010d.gif
</span></span><span style="display:flex;"><span>https://emoji.slack-edge.com/T0XXXX/octocat/627964d7c9.png
</span></span><span style="display:flex;"><span>https://emoji.slack-edge.com/T0XXXX/ohyou/6a352df984d9c076.gif
</span></span><span style="display:flex;"><span>https://emoji.slack-edge.com/T0XXXX/one-sec-cooking/e749627cb088859d.png
</span></span><span style="display:flex;"><span>https://emoji.slack-edge.com/T0XXXX/oof/db94710445cbb206.png
</span></span><span style="display:flex;"><span>https://emoji.slack-edge.com/T0XXXX/petrol/35ed3db238f795fc.png
</span></span><span style="display:flex;"><span>https://emoji.slack-edge.com/T0XXXX/piggy/b7762ee8cd.png
</span></span></code></pre></div><p>We now understand how to collect everything we need, so let’s automate this a bit more.</p>
<h2 id="the-implementation">The Implementation</h2>
<p>We’re going to write a little script that’ll download all the custom emojis from the target Slack workspace. It’s going to perform the following steps:</p>
<ol>
<li>Define a starting JSON payload.</li>
<li>Create a run loop.</li>
<li>With each loop we make a request using the API endpoint.</li>
<li>Do some error checking.</li>
<li>Iterate through the results and save them to disk.</li>
<li>If the results contain a <code>next_marker</code> update the JSON payload with a <code>marker</code> field and continue the run loop.</li>
<li>Keep going until the last request no longer provides a <code>next_marker</code>.</li>
</ol>
<p>First, we want to define some environmental variables so we can easily configure the script:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>: <span style="color:#a3be8c">${</span>SLACK_WORKSPACE_ID<span style="color:#eceff4">:=</span><span style="color:#a3be8c">}</span>
</span></span><span style="display:flex;"><span>: <span style="color:#a3be8c">${</span>SLACK_COOKIE<span style="color:#eceff4">:=</span><span style="color:#a3be8c">}</span>
</span></span><span style="display:flex;"><span>: <span style="color:#a3be8c">${</span>SLACK_TOKEN<span style="color:#eceff4">:=</span><span style="color:#a3be8c">}</span>
</span></span></code></pre></div><p>Now we define our JSON payload object. We use <code>jq</code> here to keep things easy. Not only is it great for parsing and filtering JSON in Bash, it also makes building and manipulating objects simple:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>payload<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">$(</span>
</span></span><span style="display:flex;"><span>  jq -nc <span style="color:#ebcb8b">\
</span></span></span><span style="display:flex;"><span><span style="color:#ebcb8b"></span>    --arg     token <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>SLACK_TOKEN<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#ebcb8b">\
</span></span></span><span style="display:flex;"><span><span style="color:#ebcb8b"></span>    --argjson count <span style="color:#a3be8c">&#34;100&#34;</span> <span style="color:#ebcb8b">\
</span></span></span><span style="display:flex;"><span><span style="color:#ebcb8b"></span>    <span style="color:#a3be8c">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#a3be8c">      token: $token, 
</span></span></span><span style="display:flex;"><span><span style="color:#a3be8c">      count: $count
</span></span></span><span style="display:flex;"><span><span style="color:#a3be8c">    }&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">)</span>
</span></span></code></pre></div><p>Next, is the run loop where we make our API requests. This passes through the payload object we just defined while also targeting our workspace:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">while</span> true<span style="color:#eceff4">;</span> <span style="color:#81a1c1;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>  result<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">$(</span>
</span></span><span style="display:flex;"><span>    curl -s --compressed <span style="color:#a3be8c">&#34;https://edgeapi.slack.com/cache/</span><span style="color:#a3be8c">${</span>SLACK_WORKSPACE_ID<span style="color:#a3be8c">}</span><span style="color:#a3be8c">/emojis/list?fp=97&#34;</span> <span style="color:#ebcb8b">\
</span></span></span><span style="display:flex;"><span><span style="color:#ebcb8b"></span>      -H <span style="color:#a3be8c">&#34;cookie: d=</span><span style="color:#a3be8c">${</span>SLACK_COOKIE<span style="color:#a3be8c">}</span><span style="color:#a3be8c">;&#34;</span> <span style="color:#ebcb8b">\
</span></span></span><span style="display:flex;"><span><span style="color:#ebcb8b"></span>      --data-raw <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>payload<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">done</span>
</span></span></code></pre></div><p>We obviously want to do some simple error checking so we know what we did wrong if the requests fail. Grab the error, spit it out and terminate the script.</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#81a1c1">[[</span> <span style="color:#81a1c1;font-weight:bold">$(</span><span style="color:#81a1c1">echo</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>result<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#eceff4">|</span> jq -r <span style="color:#a3be8c">&#34;.ok&#34;</span><span style="color:#81a1c1;font-weight:bold">)</span> <span style="color:#81a1c1">==</span> <span style="color:#81a1c1">false</span> <span style="color:#81a1c1">]]</span><span style="color:#eceff4">;</span> <span style="color:#81a1c1;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1">echo</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>result<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#eceff4">|</span> jq -r <span style="color:#a3be8c">&#34;.error&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1">exit</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">fi</span>
</span></span></code></pre></div><p>We now start iterating through any of the results we got from the initial request. We really only care about the <code>value</code> field as the URL gives us all the pieces we need to give our emojis a human-readable filename.</p>
<p>Here we treat the resulting URL as a standard file path and use <code>dirname</code> paired with <code>basename</code> to get the name of the parent directory of the file. The parent directory holds the actual name of the emoji, while the file itself is only a random hash. We use <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">Bash’s parameter expansion</a> feature to construct our filename.</p>
<p>Finally, we download the remote file to the current directory:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#81a1c1">echo</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>result<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span>  <span style="color:#eceff4">|</span> jq -r <span style="color:#a3be8c">&#39;.results[].value&#39;</span> <span style="color:#eceff4">|</span> <span style="color:#81a1c1;font-weight:bold">while</span> <span style="color:#81a1c1">read</span> -r url<span style="color:#eceff4">;</span> <span style="color:#81a1c1;font-weight:bold">do</span> 
</span></span><span style="display:flex;"><span>name<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">$(</span>basename <span style="color:#81a1c1;font-weight:bold">$(</span>dirname <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>url<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span><span style="color:#81a1c1;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>curl -s -o <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>name<span style="color:#a3be8c">}</span><span style="color:#a3be8c">.</span><span style="color:#a3be8c">${</span>url<span style="color:#eceff4">##*.</span><span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>url<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">done</span> 
</span></span></code></pre></div><p>We need to check if there are more results to page through, so let’s look for the <code>marker_next</code> field. If we can’t find one, then mission accomplished; all done. However, if we do get a value, we take the previous payload we constructed and <em>add</em> the <code>marker</code> field.</p>
<p>The next loop will pick this change up and pass it on through to the API request telling Slack to give us the next page of precious emojis.</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>marker<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">$(</span><span style="color:#81a1c1">echo</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>result<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#eceff4">|</span> jq -r <span style="color:#a3be8c">&#34;.next_marker&#34;</span><span style="color:#81a1c1;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">[[</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>marker<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#81a1c1">==</span> <span style="color:#a3be8c">&#34;null&#34;</span> <span style="color:#81a1c1">]]</span> <span style="color:#81a1c1">&amp;&amp;</span> <span style="color:#81a1c1">exit</span> <span style="color:#b48ead">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>payload<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">$(</span><span style="color:#81a1c1">echo</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>payload<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#eceff4">|</span> jq --arg marker <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>marker<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#a3be8c">&#39;. + { marker: $marker }&#39;</span><span style="color:#81a1c1;font-weight:bold">)</span>
</span></span></code></pre></div><h2 id="the-finished-product">The Finished Product</h2>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#5e81ac;font-style:italic">#!/usr/bin/env bash
</span></span></span><span style="display:flex;"><span><span style="color:#5e81ac;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">set</span> -eo pipefail
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>: <span style="color:#a3be8c">${</span>SLACK_WORKSPACE_ID<span style="color:#eceff4">:=</span><span style="color:#a3be8c">}</span>
</span></span><span style="display:flex;"><span>: <span style="color:#a3be8c">${</span>SLACK_COOKIE<span style="color:#eceff4">:=</span><span style="color:#a3be8c">}</span>
</span></span><span style="display:flex;"><span>: <span style="color:#a3be8c">${</span>SLACK_TOKEN<span style="color:#eceff4">:=</span><span style="color:#a3be8c">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>payload<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">$(</span>
</span></span><span style="display:flex;"><span>  jq -nc <span style="color:#ebcb8b">\
</span></span></span><span style="display:flex;"><span><span style="color:#ebcb8b"></span>    --arg     token <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>SLACK_TOKEN<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#ebcb8b">\
</span></span></span><span style="display:flex;"><span><span style="color:#ebcb8b"></span>    --argjson count <span style="color:#a3be8c">&#34;100&#34;</span> <span style="color:#ebcb8b">\
</span></span></span><span style="display:flex;"><span><span style="color:#ebcb8b"></span>    <span style="color:#a3be8c">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#a3be8c">      token: $token, 
</span></span></span><span style="display:flex;"><span><span style="color:#a3be8c">      count: $count
</span></span></span><span style="display:flex;"><span><span style="color:#a3be8c">    }&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">while</span> true<span style="color:#eceff4">;</span> <span style="color:#81a1c1;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>  result<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">$(</span>
</span></span><span style="display:flex;"><span>    curl -s --compressed <span style="color:#a3be8c">&#34;https://edgeapi.slack.com/cache/</span><span style="color:#a3be8c">${</span>SLACK_WORKSPACE_ID<span style="color:#a3be8c">}</span><span style="color:#a3be8c">/emojis/list?fp=97&#34;</span> <span style="color:#ebcb8b">\
</span></span></span><span style="display:flex;"><span><span style="color:#ebcb8b"></span>      -H <span style="color:#a3be8c">&#34;cookie: d=</span><span style="color:#a3be8c">${</span>SLACK_COOKIE<span style="color:#a3be8c">}</span><span style="color:#a3be8c">;&#34;</span> <span style="color:#ebcb8b">\
</span></span></span><span style="display:flex;"><span><span style="color:#ebcb8b"></span>      --data-raw <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>payload<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#81a1c1">[[</span> <span style="color:#81a1c1;font-weight:bold">$(</span><span style="color:#81a1c1">echo</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>result<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#eceff4">|</span> jq -r <span style="color:#a3be8c">&#34;.ok&#34;</span><span style="color:#81a1c1;font-weight:bold">)</span> <span style="color:#81a1c1">==</span> <span style="color:#81a1c1">false</span> <span style="color:#81a1c1">]]</span><span style="color:#eceff4">;</span> <span style="color:#81a1c1;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1">echo</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>result<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#eceff4">|</span> jq -r <span style="color:#a3be8c">&#34;.error&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1">exit</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1">echo</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>result<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span>  <span style="color:#eceff4">|</span> jq -r <span style="color:#a3be8c">&#39;.results[].value&#39;</span> <span style="color:#eceff4">|</span> <span style="color:#81a1c1;font-weight:bold">while</span> <span style="color:#81a1c1">read</span> -r url<span style="color:#eceff4">;</span> <span style="color:#81a1c1;font-weight:bold">do</span> 
</span></span><span style="display:flex;"><span>    name<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">$(</span>basename <span style="color:#81a1c1;font-weight:bold">$(</span>dirname <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>url<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span><span style="color:#81a1c1;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>    curl -s -o <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>name<span style="color:#a3be8c">}</span><span style="color:#a3be8c">.</span><span style="color:#a3be8c">${</span>url<span style="color:#eceff4">##*.</span><span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>url<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  marker<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">$(</span><span style="color:#81a1c1">echo</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>result<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#eceff4">|</span> jq -r <span style="color:#a3be8c">&#34;.next_marker&#34;</span><span style="color:#81a1c1;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1">[[</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>marker<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#81a1c1">==</span> <span style="color:#a3be8c">&#34;null&#34;</span> <span style="color:#81a1c1">]]</span> <span style="color:#81a1c1">&amp;&amp;</span> <span style="color:#81a1c1">exit</span> <span style="color:#b48ead">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  payload<span style="color:#81a1c1">=</span><span style="color:#81a1c1;font-weight:bold">$(</span><span style="color:#81a1c1">echo</span> <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>payload<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#eceff4">|</span> jq --arg marker <span style="color:#a3be8c">&#34;</span><span style="color:#a3be8c">${</span>marker<span style="color:#a3be8c">}</span><span style="color:#a3be8c">&#34;</span> <span style="color:#a3be8c">&#39;. + { marker: $marker }&#39;</span><span style="color:#81a1c1;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">done</span>
</span></span></code></pre></div><p>This is pretty much it. A barebones script that downloads all findings to its present working directory. To test it out yourself, make the script executable, define the environmental variables and fire it off like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ SLACK_WORKSPACE_ID<span style="color:#81a1c1">=</span>*** SLACK_COOKIE<span style="color:#81a1c1">=</span>*** SLACK_TOKEN<span style="color:#81a1c1">=</span>*** ./fetch.sh
</span></span></code></pre></div><h2 id="an-even-better-version">An Even Better Version!</h2>
<p>I know I just made you read through all this, but you also could’ve just downloaded the tool from here. It’s got heaps more bells and whistles ( if you’re into that sort of thing):</p>
<p>%[https://github.com/wilhelm-murdoch/slack-emoji-toolkit]</p>
<h2 id="the-bitter-irony">The Bitter Irony</h2>
<p>In typical bored engineer fashion, I’ve spent more time writing this article, documenting and publishing the code than I ever would have personally just “handraulically” doing this from time to time.</p>
<p>Hopefully, you’ve learned something new! 🤞</p>
<h2 id="bonus-relevant-xkcd-image">Bonus Relevant XKCD Image</h2>
<p>![Untitled.png](<a href="https://cdn.hashnode.com/res/hashnode/image/upload/v1663601487957/aTOrHhP9G.png">https://cdn.hashnode.com/res/hashnode/image/upload/v1663601487957/aTOrHhP9G.png</a> align=&ldquo;left&rdquo;)</p>
  </article>

      </main>
      <footer class="mx-auto max-w-2xl text-center text-sm text-slate-400">
        <div class="my-8 flex justify-center space-x-6">
  <a href="https://keybase.io/wilhelm" title="Keybase" class="transition duration-200 text-slate-300 hover:text-slate-400">
    <span class="sr-only">Keybase</span>
    <svg class="h-6 w-6" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
      
      <path d="M286.2 419a18 18 0 1 0 18 18 18 18 0 0 0 -18-18zm111.9-147.6c-9.5-14.6-39.4-52.5-87.3-73.7q-9.1-4.1-18.4-7.3a78.4 78.4 0 0 0 -47.9-104.1c-12.4-4.1-23.3-6-32.4-5.8-.6-2-1.9-11 9.4-35L198.7 32l-5.5 7.6c-8.7 12.1-16.9 23.6-24.3 34.9a51 51 0 0 0 -8.3-1.3c-41.5-2.5-39-2.3-41.1-2.3-50.6 0-50.8 52.1-50.8 45.9l-2.4 36.7c-1.6 27 19.8 50.2 47.6 51.9l8.9 .5a214 214 0 0 0 -46.3 35.5C14 304.7 14 374 14 429.8v33.6l23.3-29.8a148.6 148.6 0 0 0 14.6 37.6c5.8 10.1 14.9 9.5 19.6 7.3 4.2-1.9 10-6.9 3.8-20.1a178.3 178.3 0 0 1 -15.8-53.1l46.8-59.8-24.7 74.1c58.2-42.4 157.4-61.8 236.3-38.6 34.2 10.1 67.5 .7 84.7-23.8 .7-1 1.2-2.2 1.9-3.2a156.1 156.1 0 0 1 2.8 28.4c0 23.3-3.7 52.9-14.9 81.6-2.5 6.5 1.8 14.5 8.6 15.7 7.4 1.6 15.3-3.1 18.4-11.2C429 443 434 414 434 382.3c0-38.6-13-77.5-35.9-110.9zM142.4 128.6l-15.7-.9-1.4 21.8 13.1 .8a93 93 0 0 0 .3 19.6l-22.4-1.3a12.3 12.3 0 0 1 -11.8-12.8L107 119c1-12.2 13.9-11.3 13.3-11.3l29.1 1.7a144.4 144.4 0 0 0 -7 19.2zm148.4 172.2a10.5 10.5 0 0 1 -14.4-1.4l-9.7-11.5-34.4 27a8.1 8.1 0 0 1 -11.1-1.1l-15.8-18.6a7.4 7.4 0 0 1 1.3-10.3l34.6-27.2-14.1-16.7-17.1 13.5a7.8 7.8 0 0 1 -10.6-1s-3.7-4.4-3.8-4.5a7.4 7.4 0 0 1 1.4-10.3L214 225.2s-18.5-22-18.6-22.1a9.6 9.6 0 0 1 1.7-13.4 10.4 10.4 0 0 1 14.3 1.4l81.1 96.3a9.6 9.6 0 0 1 -1.7 13.4zM187.4 419a18 18 0 1 0 18 18 18 18 0 0 0 -18-18z" />
    </svg>
  </a>

  <a href="https://github.com/wilhelm-murdoch" title="GitHub" class="transition duration-200 text-slate-300 hover:text-slate-400">
    <span class="sr-only">GitHub</span>
    <svg class="h-6 w-6" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
      
      <path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" />
    </svg>
  </a>

  <a href="https://bsky.app/profile/wilhelm.codes" title="Bluesky" class="transition duration-200 text-slate-300 hover:text-slate-400">
    <span class="sr-only">Bluesky</span>
    <svg class="h-6 w-6" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
      
      <path d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2c42.1-31.6 110.3-56 110.3 21.8c0 15.5-8.9 130.5-14.1 149.2C478.2 298 412 314.6 353.1 304.5c102.9 17.5 129.1 75.5 72.5 133.5c-107.4 110.2-154.3-27.6-166.3-62.9l0 0c-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8l0 0c-12 35.3-59 173.1-166.3 62.9c-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1C10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z" />
    </svg>
  </a>

  <a href="https://www.linkedin.com/in/wilhelmmurdoch" title="LinkedIn" class="transition duration-200 text-slate-300 hover:text-slate-400">
    <span class="sr-only">LinkedIn</span>
    <svg class="h-6 w-6" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
      
      <path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z" />
    </svg>
  </a>

  <a href="https://app.daily.dev/blitzkriegpunk" title="Daily.dev" class="transition duration-200 text-slate-300 hover:text-slate-400">
    <span class="sr-only">Daily.dev</span>
    <svg class="h-7 w-7 fill-current" viewBox="0 0 24 24"><g fill-rule="evenodd"><path d="M19.174 11.59l-2.207-2.208 1.103-2.207 3.587 3.587a1.17 1.17 0 010 1.655l-4.415 4.416a1.17 1.17 0 01-1.655-1.656l3.587-3.587z" opacity=".56"></path><path d="M15.588 6.343a1.17 1.17 0 011.655 0l.828.828-9.658 9.657a1.17 1.17 0 01-1.655 0L5.93 16l9.658-9.657zm-4.14 3.035l-1.655 1.656-2.208-2.208-2.76 2.76 2.208 2.207L5.93 16l-3.587-3.587a1.17 1.17 0 010-1.655l4.415-4.415a1.17 1.17 0 011.655 0l3.036 3.035z"></path></g></svg>
  </a>
</div>

Made with
<svg class="w-6 h-6 text-red-600 inline-block heartbeat-animation" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
</svg>
by yours truly;
<a href="https://wilhelm.codes" title="It me.">me</a>
<img class="inline-block h-6 w-6 rounded-full border-2 jello-animation" src="https://s.gravatar.com/avatar/7cc6bee5975704b299bd7355e8ba9356?s=40" alt="It me." />
<div class="text-center text-slate-200 text-sm mt-8 font-mono">
  
</div>
      </footer>
    </div>
  </body>
</html>